<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <style>
        /* 0-1029 */
        /* body{background-image: url('https://picsum.photos/id/237/1280/720');} */
        /* .parallax{
            background: url('https://picsum.photos/id/237/1280/720')
            center center no-repeat;
            min-height: 600px;
            background-attachment: fixed;
            background-size: cover;
        } */
    </style>
</head>
<!--
    老師提供的方法:
    把main用position:relative;top:-100% 的方式
    閃掉parallax-mirror造成的擠壓
-->

<body>
    <noscript>
        <h1>Use Javascript</h1>
    </noscript>
    <header id="header"></header>
    <!-- <img src="https://picsum.photos/id/237/640/480" class="thumbnail"> -->
    <div class="parallax-bg"></div>
    <!-- style="background: transparent;"-->
    <main id="main">
        <div class="btn">btn</div>
    </main>
    <footer id="footer"></footer>

    <script src="./js/jquery_3.7.0_jquery.min.js"></script>
    <script src="./js/bootstrap.bundle.min.js"></script>
    <script src="./js/simpleParallax.min.js"></script>
    <script>
        // https://blog.tarswork.com/post/how-to-create-a-parallax-scrolling-effect/
        function init_display() {
            // let bg = $('.parallax::before')
            let bg=$('.parallax-bg')
            let main=$('#main')
            let bgHeight
            function init_background() {
                /**
                 * 建立function更改css:
                 * ajax成功時執行一次
                 * 失敗時重新亂數在執行一次
                */
               let randBg = Math.floor(Math.random() * 1029)
                // console.log($.get("https://picsum.photos/id/"+randBg+"/1/1"))
                // new simpleParallax(bg.get(0))
                console.log();
                bgHeight = document.body.scrollHeight
                if (screen.width / 4 * 3 > screen.height) {
                    bg.parallax({
                        imageSrc:"https://picsum.photos/id/" + randBg + "/" + screen.width + "/" + screen.width / 4 * 3,
                        speed:0.01
                    })
                    document.body.
                    // let out="url('https://picsum.photos/id/237/"+screen.width+"/"+screen.width/4*3+"') / "+screen.width+"px auto"
                    console.log('width');
                    // $.get("https://picsum.photos/id/"+randBg+"/1/1")
                    // bg.css('background-image', "url('https://picsum.photos/id/" + randBg + "/" + screen.width + "/" + screen.width / 4 * 3 + "')")
                    // bg.css('background-size', screen.width + "px auto")
                    // bg.innerWidth(screen.width)
                    // bg.css('width',screen.width)
                    
                } else {
                    // bgHeight = screen.height
                    bg.parallax({
                        imageSrc:"https://picsum.photos/id/" + randBg + "/" + screen.height / 3 * 4 + "/" + screen.height,
                        speed:0.01
                    })
                    console.log('height');
                    // bg.css('background',"url('https://picsum.photos/id/237/"+screen.height/3*4+"/"+screen.height+"') / auto "+screen.height+"px")
                    // bg.css('background-image', "url('https://picsum.photos/id/" + randBg + "/" + screen.height / 3 * 4 + "/" + screen.height + "')")
                    // bg.css('background-size', "auto " + screen.height + "px")
                    // bg.innerHeight(screen.height)
                    // bg.css('height',screen.height)
                    
                }
                bg.css({
                    'height':bgHeight+"px"
                })
                main.css({
                    'position':'relative',
                    'top':-screen.height
                })
                // bg.css({
                //     'content':"",
                //     'background-repeat': "no-repeat",
                //     // 'background-position': "0 " + headerHeight + "px",
                //     'background-color': "rgba(255,255,255,0.6)",
                //     'background-blend-mode': 'overlay'
                // })
            }

            // parallax
            // function updateBackgroundPosition() {
            //     let scrollPositionY = window.pageYOffset;
            //     let bgHeight = bg.height();
            //     let docHeight = document.body.scrollHeight;
            //     bg.css('background-position', '0 ' + (scrollPositionY * (bgHeight / docHeight)) + "px");
            // }
            $(window).scroll(() => {
                // requestAnimationFrame(updateBackgroundPosition)
            })
            // console.log(screen.height);
            init_background()
        }
        function page_initialization() {
            var headerLoaded = $.Deferred();
            var footerLoaded = $.Deferred();
            var mainLoaded = $.Deferred();
            $('#header').load('./parts/header.html', function () {
                headerHeight = $('#header').height()
                headerLoaded.resolve();
            })
            $('#footer').load('./parts/footer.html', function () {
                footerLoaded.resolve();
            })
            //debug
            $('#main').load('./features/flow.html', function () {
                mainLoaded.resolve();
            })
            // $.get('./features/flow.html',function(d){
            //     $('#main').html(d)
            // })
            $.when(headerLoaded, footerLoaded, mainLoaded).done(function () {
                
            })
        }
        function jq_start_function() {
            page_initialization()
            init_display()
        }

        let headerHeight

        $(document).ready(jq_start_function)
    </script>
</body>

</html>